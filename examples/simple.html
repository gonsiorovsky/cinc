<!DOCTYPE html>
<html>
    <head>
        <script src="../cinc.js"></script>
        <script>
            provide('test_module_a', function() {
                var s = 'test_module_a';
                document.write('this.m: ' + this.m + '<br>');
                return {
                    do_it: function() {
                        document.write('--- module message: ' + s + '<br>');
                    }
                };
            });

            provide('test_module_b', function(s) {
                document.write('this.m: ' + this.m + '<br>');
                return {
                    do_it: function() {
                        document.write('--- module message: ' + s + '<br>');
                    }
                }
            });

            provide('test_module_c', function() {
                document.write('this.m: ' + this.m + '<br>');
                return {
                    do_it: function(s) {
                        document.write('--- module message: ' + s + '<br>');
                    }
                }
            });

            provide('test_module_d', {
                do_it: function(s) {
                    document.write('--- module message: ' + s + '<br>');
                }
            });
        </script>
        <script>
            this.m = 'test';

            document.write('<p>')
            document.write('Window scope:<br>');
            var TM_A = use('test_module_a');
            var TM_B = use('test_module_b', ['test_module_b']);
            TM_A.do_it();
            TM_B.do_it();
            document.write('</p>')
            
            var x = {
                func: function() {
                    var TM_C = use(this, 'test_module_c');
                    var TM_D = use(this, 'test_module_d');
                    TM_C.do_it('test_module_c');
                    TM_D.do_it('test_module_d');

                    document.write('<p>');
                    document.write('Inner function:<br>');
                    document.write('this.TM_A: ' + this.TM_A + '<br>');
                    document.write('this.TM_B: ' + this.TM_B + '<br>');
                    document.write('this.TM_C: ' + this.TM_C + '<br>');
                    document.write('this.TM_D: ' + this.TM_D + '<br>');
                    document.write('</p>');
                }
            };
        
            document.write('<p>')
            document.write('Inner function:<br>');
            x.func();
            document.write('</p>')

            document.write('<p>');
            document.write('Window scope:<br>');
            document.write('this.TM_A: ' + this.TM_A + '<br>');
            document.write('this.TM_B: ' + this.TM_B + '<br>');
            document.write('this.TM_C: ' + this.TM_C + '<br>');
            document.write('this.TM_D: ' + this.TM_D + '<br>');
            document.write('</p>');
        </script>
    </head>
    <body>
    </body>
</html>
